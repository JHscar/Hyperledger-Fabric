# Hyperledger Fabric

### Channel

- 네트워크 멤버들 사이의 서브넷 (하위 네트워크)
  - 특정 멤버들(피어, 유저, org)끼리만 블록체인과 스마트 컨트랙트를 공유할 수 있다.
  - 다른 채널의 데이터는 접근 할 수 없다.
    - PeerA가 채널 가, 나 둘 다 가입되어있으면 PeerA는 둘 다 접근 가능

- MSP, identity에 의해서 식별 될 수 있다.
- 채널 별로 블록체인이 따로 존재
  - 채널을 만들 때  genesis block에 채널의 정보가 있는 트랜젝션으로 시작한다.

- 채널에 피어들이 블록을 공유할 때
  - 리더 피어 : 오더러와 연결해서 블록을 가져오는 애 (가장 먼저)
  - 앵커링 피어 : 네트워크 관련 정보를 공유한다.



### 정리

- 피어가 레져를 들고 있다.
- 레져는 채널 별로 관리 된다.
- 다른 채널에 체인코드는 ( 가입 되어 있지 않으면 ) 호출 할 수 없다.



----------------------------------------------------------------------------------------------------------



## Gossip Protocol

### Peer의 역할 종류

- 커미터
  - 모든 peer는 커미터
  - 블록체인(레져)를 가지고 있고, excute, validate 하는 역할

- 앵커
  - 자신이 속한 organization의 네트워크 정보를 가지고 있고, 전달해주는 역할

- 리더
  - 오더러로부터 블록을 받아온다.
  - 어드민이 리더를 정해줄 수도 있고, 자기들끼리 선택할 수도 있다.



#### 피어(앵커)

- (cli를 이용해서) 채널을 만들 때 오더러 옵션을 통해서 알리게 된다.
- 앵커 피어 : 앵커 피어 트랜젝션을 통해서 네트워크에 알릴 수 있다.
- 부트스트랩 피어 설정

#### 피어 (리더)

- 어드민이 정의
  - 환경변수 or core.yaml을 통해 정의

- 다이나믹으로 선언
  - 1명의 leader, 나머지는 follower
  - peer들은 항상 서로에게 heart beats를 날린다.
  - leader의 heart beats가 안오면 리더 선출이 시작되고 ID가 높은 Peer가 리더 피어가 된다.

#### 오더러 연결

- config를 통해서 연결(genesis.block)



-----------------------------------------------------------------------------------------------



### Fabric 이벤트

- Fabric에서는 다양한 레벨의 이벤트를 받을 수 있음
- SDK를 이용하여 Peer로 부터 이벤트를 수신
  - grpc

- Block from~to 가능(replay도 가능)
- 기존 event-hub -> channel based event

### Fabric 이벤트 종류

1. Block event

   a. Full Block

   b. Filtered Block(event에 있는 payload 가져오지 않는다)

2. TX event

3. Chaincode event

   a. chaincode 내에서 SetEvent(eventname, payload)